# Open the pmux device?
out: 78 75 6D 70 03 37 00 00 01 00 00 00 01 00 00 00 0C 00 00 00 28 00 00 00 00 00 00 00 03 00 00 00 00 10 00 00 0C 00 00 00
in : 78 75 6D 70 03 62 01 00 01 00 00 00 01 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00

# "open tty://"
out: 78 75 6D 70 03 37 00 00 00 10 00 00 01 00 00 00 0B 00 00 00 27 00 00 00 00 00 00 00 6F 70 65 6E 20 74 74 79 3A 2F 2F
in : 78 75 6D 70 03 62 01 00 00 10 00 00 01 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00
# "ok 0" where 0 is the term number?
in : 78 75 6D 70 03 62 00 00 00 10 00 00 01 00 00 00 05 00 00 00 21 00 00 00 00 00 00 00 6F 6B 20 30 0A
out: 78 75 6D 70 03 37 01 00 00 10 00 00 01 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00

# Terminal action
in : 78 75 6D 70 03 62 00 00 00 10 00 00 02 00 00 00 1F 00 00 00 3B 00 00 00 00 00 00 00 AD FB CA DE 01 00 00 00 0F 00 00 00 00 00 00 00 72 6F 6F 74 40 63 61 73 74 6C 65 3A 2F 23 20
out: 78 75 6D 70 03 37 01 00 00 10 00 00 02 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00
out: 78 75 6D 70 03 37 00 00 00 10 00 00 02 00 00 00 20 00 00 00 3C 00 00 00 00 00 00 00 AD FB CA DE 01 00 00 00 10 00 00 00 00 00 00 00 74 68 69 73 20 69 73 20 61 20 74 65 72 6D 0D 0A
in : 78 75 6D 70 03 62 01 00 00 10 00 00 02 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00
in : 78 75 6D 70 03 62 00 00 00 10 00 00 03 00 00 00 5A 00 00 00 76 00 00 00 00 00 00 00 AD FB CA DE 01 00 00 00 4A 00 00 00 00 00 00 00 74 68 69 73 20 69 73 20 61 20 74 65 72 6D 0D 0A 2F 62 69 6E 2F 73 68 3A 20 74 68 69 73 3A 20 6E 6F 74 20 66 6F 75 6E 64 0D 0A 72 6F 6F 74 40 63 61 73 74 6C 65 3A 2F 23 20 0D 0A 72 6F 6F 74 40 63 61 73 74 6C 65 3A 2F 23 20
out: 78 75 6D 70 03 37 01 00 00 10 00 00 03 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00
out: 78 75 6D 70 03 37 00 00 00 10 00 00 03 00 00 00 15 00 00 00 31 00 00 00 00 00 00 00 AD FB CA DE 01 00 00 00 05 00 00 00 00 00 00 00 79 61 79 0D 0A
in : 78 75 6D 70 03 62 01 00 00 10 00 00 03 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00
in : 78 75 6D 70 03 62 00 00 00 10 00 00 04 00 00 00 4E 00 00 00 6A 00 00 00 00 00 00 00 AD FB CA DE 01 00 00 00 3E 00 00 00 00 00 00 00 79 61 79 0D 0A 2F 62 69 6E 2F 73 68 3A 20 79 61 79 3A 20 6E 6F 74 20 66 6F 75 6E 64 0D 0A 72 6F 6F 74 40 63 61 73 74 6C 65 3A 2F 23 20 0D 0A 72 6F 6F 74 40 63 61 73 74 6C 65 3A 2F 23 20
out: 78 75 6D 70 03 37 01 00 00 10 00 00 04 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00
out: 78 75 6D 70 03 37 00 00 00 10 00 00 04 00 00 00 18 00 00 00 34 00 00 00 00 00 00 00 AD FB CA DE 01 00 00 00 08 00 00 00 00 00 00 00 6C 73 20 2D 6C 61 0D 0A
in : 78 75 6D 70 03 62 01 00 00 10 00 00 04 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00
in : 78 75 6D 70 03 62 00 00 00 10 00 00 05 00 00 00 18 00 00 00 34 00 00 00 00 00 00 00 AD FB CA DE 01 00 00 00 08 00 00 00 00 00 00 00 6C 73 20 2D 6C 61 0D 0A
out: 78 75 6D 70 03 37 01 00 00 10 00 00 05 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00
in : 78 75 6D 70 03 62 00 00 00 10 00 00 06 00 00 00 C4 05 00 00 E0 05 00 00 00 00 00 00 AD FB CA DE 01 00 00 00 B4 05 00 00 00 00 00 00 64 72 77 78 72 2D 78 72 2D 78 20 20 20 32 31 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4A 75 6E 20 31 31 20 30 32 3A 31 38 20 2E 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 32 31 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4A 75 6E 20 31 31 20 30 32 3A 31 38 20 2E 2E 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 20 32 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4A 75 6E 20 31 30 20 32 31 3A 30 34 20 62 69 6E 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 31 32 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 44 65 63 20 33 31 20 20 31 39 39 39 20 62 6F 6F 74 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 31 37 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 33 32 36 30 20 4A 75 6E 20 31 33 20 31 31 3A 31 33 20 64 65 76 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 20 32 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 44 65 63 20 33 31 20 20 31 39 39 39 20 64 73 70 62 72 69 64 67 65 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 34 33 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4A 75 6E 20 31 30 20 32 31 3A 30 34 20 65 74 63 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 20 32 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4A 75 6E 20 31 31 20 30 32 3A 31 38 20 66 73 0D 0A 2D 72 2D 2D 72 2D 2D 72 2D 2D 20 20 20 20 31 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 20 20 20 30 20 4A 75 6E 20 31 30 20 30 31 3A 34 36 20 68 65 6C 6C 6F 0D 0D 0A 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 20 33 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4A 75 6E 20 31 30 20 32 31 3A 30 35 20 68 6F 6D 65 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 20 36 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 44 65 63 20 33 31 20 20 31 39 39 39 20 6C 69 62 0D 0A 64 72 77 78 2D 2D 2D 2D 2D 2D 20 20 20 20 32 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 31 36 33 38 34 20 44 65 63 20 33 31 20 20 31 39 39 39 20 6C 6F 73 74 2B 66 6F 75 6E 64 0D 0A 2D 72 77 2D 72 2D 2D 72 2D 2D 20 20 20 20 31 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 38 36 39 36 35 30 20 4D 61 79 20 32 32 20 31 37 3A 34 33 20 6D 64 35 73 75 6D 73 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 31 31 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 44 65 63 20 33 31 20 20 31 39 39 39 20 6D 65 64 69 61 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 20 32 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 44 65 63 20 33 31 20 20 31 39 39 39 20 6D 6E 74 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 20 39 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4A 75 6E 20 31 32 20 31 37 3A 33 33 20 6F 70 74 0D 0A 64 72 2D 78 72 2D 78 72 2D 78 20 20 20 39 36 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 20 20 20 30 20 44 65 63 20 33 31 20 20 31 39 36 39 20 70 72 6F 63 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 20 32 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4A 75 6E 20 31 30 20 32 30 3A 33 37 20 72 6F 6F 74 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 20 33 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 44 65 63 20 33 31 20 20 31 39 39 39 20 73 62 69 6E 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 31 32 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 20 20 20 30 20 44 65 63 20 33 31 20 20 31 39 36 39 20 73 79 73 0D 0A 64 72 77 78 72 77 78 72 77 74 20 20 20 31 30 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 20 35 34 30 20 4A 75 6E 20 31 33 20 31 34 3A 34 34 20 74 6D 70 0D 0A 64 72 77 78 72 2D 78 72 2D 78 20 20 20 31 33 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4D 61 79 20 32 32 20 31 36 3A 30 38 20 75 73 72 0D 0A 64 72 77 78 72 77 78 72 2D 78 20 20 20 33 32 20 72 6F 6F 74 20 20 20 20 20 72 6F 6F 74 20 20 20 20 20 20 20 20 20 34 30 39 36 20 4A 75 6E 20 20 34 20 32 30 3A 32 34 20 76 61 72 0D 0A 72 6F 6F 74 40 63 61 73 74 6C 65 3A 2F 23 20 0D 0A 72 6F 6F 74 40 63 61 73 74 6C 65 3A 2F 23 20
out: 78 75 6D 70 03 37 01 00 00 10 00 00 06 00 00 00 00 00 00 00 1C 00 00 00 00 00 00 00

uint32 magic                # "pmux"
char mode                   # 3 = open? ... maybe others are used for get, put, execute, and boot?
char direction              # 0x62 = in, 0x37 = out .. could be a port designator?
uint16 ack                  # 0 = sent, 1 = ack
uint16 status               # 0x0001 = not connected, 0x1000 = established ... 0x0001 = control, 0x1000 = data
uint16 zero                 # always zero ?
uint32 sequence_num         # sequence number for input or output ... each side keeps their own independent count
uint32 length_payload       # total payload length
uint32 length_pmux_header   # always payload_length + 28 ?
uint32 zero                 # always zero ?

#define PMUX_MAGIC              0x706d7578
#define PMUX_MODE_TTY           3
#define PMUX_DIR_IN             0x62
#define PMUX_DIR_OUT            0x37
#define PMUX_CONNECTION_DATA    0x1000
#define PMUX_CONNECTION_OPEN    0x0001

// Structure to open the tty
typedef struct {
    uint32 three ;
    uint32 ten ;
    uint32 dee ;
} pmux_pmux_open_t ;

typedef struct {
    char opentty[] = "open tty://" ;
} pmux_tty_open_request_t ;

typedef struct {
    char reply[0] ;
} pmux_tty_open_reply_t ;

// Structure for the tty
typedef struct {
    uint32 magic ;
    uint32 one ;
    uint32 length ;
    uint32 zero ;
    char payload[0] ;
} pmux_tty_payload_t ;

typedef struct {
    uint32 magic ;
    char mode ;
    char direction ;
    uint16 ack ;
    uint16 status ;
    uint32 sequence_num ;
    uint32 length_payload ;
    uint32 length_pmux_packet ;
    uint32 zero ;
    char payload[0] ;
} pmux_packet_t ;